- There is a piece of the network layer in each and every host and router in the network
- 2 parts of the network layer
	- Data plane
		- Per-router functions in the network layer that determine how a datagram arriving on one of the router's input links is forwarded to one of that router's output links
	- Control plane
		- The network wide logic that controls how a datagram is routed among routers along an end-to-end path from source host to the destination host
- Software defined networking (SDN) explicitly separates the data plane and control plane by implementing these control plane functions as a separate service

## Overview of Network Layer

<img src="/images/Pasted image 20251219101556.png" alt="image" width="500">

- The primary data plane role of each router is to forward datagrams from its input links to its output links
- The primary role of the network control plane is to coordinate these local, per-router forwarding actions so that datagrams are ultimately transferred end-to-end, along paths of routers between source and destination hosts

### Forwarding and Routing: The Network Data and Control Planes

- Move packets from a sending host to a receiving host
	- Forwarding
		- Implemented in the data plane
		- A packet travelling to Host A to B
		- Packet may also be blocked from existing a router or duplicated and send over multiple outgoing links
	- Routing
		- Routing algorithms
		- Implemented in the control plane

- Forwarding refers to the router-local action of transferring a packet from an input link interface to the appropriate output link interface
	- Short timescales
	- Implemented in hardware
- Routing refers to the network-wide process that determines the end-to-end paths that packets take from source to destination
	- Longer timesvales
	- Implemented in software

- Forwarding table
	- A router forwards a packet by examining the value of one or more fields in the arriving packet's header
	- Uses these header values to index into its forwarding table
	- The stored values indicate the outgoing link

<img src="/images/Pasted image 20251219102306.png" alt="image" width="500">

**Control Plane: The Traditional Approach**
- The routing algorithm determines the contents of the routers' forwarding tables
- The routing algorithm function in one router communicates with the routing algorithm function in other routers
- Exchanges messages containing routing information

**Control Plane: SDN Approach**
- A physically separate (from the routers), remote controller computes and distributes the forwarding tables for each router

<img src="/images/Pasted image 20251219102606.png" alt="image" width="500">

- Linux OS code

### Network Service Models

- The network service model defines the characteristics of end-to-end delivery of packets between sending an receiving hosts

Services
1. Guaranteed delivery
2. Guaranteed delivery with bounded delay
3. In-order packet delivery
4. Guaranteed minimal bandwidth
5. Security

- The Internet's network layer provides a single service, known as best-effort service
- Packets are neither guaranteed to be received in the order, or delivered
- ATM network architecture provides for guaranteed in-order delay, bounded delay, and guaranteed minimal bandwidth
- Intserv architecture aims to provide end-end delay guarantees and congestion-free communication

- Forwarding and switching are used interchangeably
- Packet switch means a general packet-switching device that transfers a packet from input link interface to output link interface
- Some packet switches, called link-layer switches, base their forwarding decision value in the field of the link-layer frame
	- Switches are referred to as link layer devices
- Other packet switches, called routers, base their forwarding decision on header field values in the network-layer datagram
	- Routers are network-layer devices

## What's Inside a Router?


<img src="/images/Pasted image 20251219183237.png" alt="image" width="500">


4 Components of a Router
1) Input ports
	1) Physical layer function of terminating an incoming physical link at a router
	2) Performs link-layer functions needed to interoperate with the link layer at the other side of the incoming link
	3) Lookup function is also performed at the input port
2) Switching fabric
	1) Connects the router's input ports and output ports
	2) Contained within the router
3) Output ports
	1) Stores packets received from the switching fabric and transmits these packets on the outgoing link by performing the necessary link-layer and physical-layer function
	2) Bidirectional, an output port will be paired with the input port for that link on the same line card
4) Routing processor
	1) Performs control plane functions
	2) Traditional routers
		1) Routing protocols
		2) Routing tables
		3) Computes the forwarding table
	3) SDN routers
		1) Communicates with the remote controller in order to receive forwarding table entries from remote controller

- Control plane functions are implemented in software and execute on the routing processor (CPU)

Processing
- Destination based forwarding
- Generalized forwarding

### Input Port Processing and Destination-Based Forwarding

- Forwarding table is either computed and updated by the routing processor or is received from a remote SDN controller
- Table is copied from the routing processor to the line cards over a separate bus (PCI)
- Forwarding decisions can be made locally, at each input port

<img src="/images/Pasted image 20251219184233.png" alt="image" width="500">

- 32-bit IP addresses, a brute-force implementation oof the forwarding table is used to get the destination address

```c
Link Interface --- Destination Address Range

0 --- 11001000 00010111 00010000 00000000 through 11001000 00010111 00010111 1111111

1 --- 11001000 00010111 00011000 00000000 through 11001000 00010111 00011000 11111111

2 ---11001000 00010111 00011001 00000000 through 11001000 00010111 00011111 11111111

3 --- Otherwise
```

<img src="/images/Pasted image 20251219184535.png" alt="image" width="500">

- The router matches a prefix of the packet destination address with the entries in the table
- When there are multiple matches, the router uses the longest prefix matching rule
- Embedded on-chip DRAM and faster SRAM (used as DRAM cache) is used
- Ternary Content Addressable Memories (TCAMs) are also used for lookup
- Physical and link layer processing must occur
- Packet's version number
- Checksum and time-to-live field
- In a network address translator (NAT), an incoming packet whose transport-layer port number matches a given value will have its port number rewritten before forwarding

### Switching

- Switching via memory
	- Under direct control of the CPU
	- Two packets cannot be forwarded at the same time
- Switching via a bus
	- Input port transfers a packet directly to the output port over a shared bus
	- Without intervention by the router processor
	- Switching speed of the router is limited to the bus speed
- Switching via an interconnection network
	- Each vertical bus intersects each horizontal bus at a crosspoint
	- A crossbar switch is non-blocking
		- A packet being forwarded to an output port will not be blocked from reaching that output port as long as no other packet is currently being forwarded to that output port
		- Cisco, CRS uses a three-stage non-blocking switching strategy

<img src="/images/Pasted image 20251220110546.png" alt="image" width="500">

<img src="/images/Pasted image 20251220110556.png" alt="image" width="500">
### Output Port Processing

- Takes packets that have been stored in the output port's memory and transmits them over the output link
- Selecting and de-queuing packets for transmission

### Where Does Queuing Occur?

- Packet queues may form at both the input and output ports
- Location and extent will depend on
	- Traffic load
	- Relative speed of the switching fabric
	- Line speed
- When queues grow large, the router's memory can eventually be exhausted and packet loss will occur when no memory is available

![[Pasted image 20251220110901.png]]


**Input Queueing**
- Multiple packets cam be transferred in parallel, as long as their output ports are diferent
- If two packets at the front have the same destination, then one packet is blocked


![[Pasted image 20251220111223.png]]

- Head-of-the-line (HOL) blocking in an input queued switch
	- A queued packet in an input queue must wait for transfer through the fabric because it is blocked by another packet at the head of the line
- The middle destined packet must wait, since it is behind the packets which is blocked


**Output Queueing**
- Packet queues can form at the output ports even when the switching fabric is N times faster than the port line speeds
- When there is not enough memory to buffer an incoming packet, a decision must be made to either drop the arriving packet (drop-tail) or remove one or more already-queued packets
- Proactive packet-dropping and marking policies are known as active queue management (AQM) algorithms
	- Random Early Detection (RED)


![[Pasted image 20251220111742.png]]

- Packet scheduler at the output port must choose one packet for transmission

### Packet Scheduling

- First-come-first server (FSFS), also known as FIFO
- Priority basis
- Round-robin

**First-In-First-Out (FIFO)**

![[Pasted image 20251220112209.png]]

- Packet arrivals are indicated by numbered arrows above the uppter timeline, with the number indicating the order in which the packet arrived

## The Internet Protocol (IP): IPv4, Addressing, IPv6, and More

### IPv4 Datagram Format

### IPv4 Datagram Fragmentation

### IPv4 Addressing

### Networking Address Translation (NAT)

### IPv6

## Generalized Forwarding and SDN

### Match

### Action

### OpenFlow Examples of Match-plus-action in Action

## Summary