- Control-plane component of network layer
	- Network wide logic that controls not only how a datagram is forwarded among routers, but also how network-layer components and services are configured and managed

- Traditionally, control-plane routing protocols have been implemented together with data-plane forwarding functions, monolithically, within a router
- Software-defined networking (SDN) makes a clear separation between the data and control planes

## Introduction

2 Possible Approaches to Forwarding
1. Per-routing control
2. Logically centralized control

<img src="/images/Pasted image 20251220161014.png" alt="image" width="500">

<img src="/images/Pasted image 20251220161026.png" alt="image" width="500">

- The controller interacts with a control agent (CA) in each of the routers via a well-defined protocol to configure and manage the router's flow table
- Google uses SDN to control the routers in its internal B4 global wide-area network
- SWAN, from Microsoft, uses a logically centralized controller to manage routing and forwarding between a wide area network and a data centre network

## Routing Algorithms

- A good path is one that has the least cost
- Routing algorithms that compute these paths are a fundamental importance
- Graph, $G = (N, E)$ is a set of $N$ nodes and a collection $E$ of edges, where each edge is a pair of nodes from $N$

<img src="/images/Pasted image 20251220161341.png" alt="image" width="500">

- An edge cost may reflect the physical length, link speed, monetary cost
- A natural goal of routing algorithm is to identify the least costly paths between sources and destinations
- The least cost problem
	- Find a path between the source and destination that has the least cost
	- Also called the shortest path

Classifying Routing Algorithms
- Centralized
	- Least-cost path between source and destination using complete, global knowledge about the network
	- Algorithms with global state information are often referred to as link-state (LS) algorithm
- Decentralized
	- Least-cost path carried out in an iterative, distributed manner by the routers
	- Only knowledge of the costs of its own directly attached links
	- Distance-vector (DV) algorithm

- Static
	- Routes change very slowly over time
	- Result of human intervention
- Dynamic
	- Change the routing paths as the network traffic loads or topology change
	- Run periodically or in direct response to topology or link cost changes

- Load-sensitive
	- Link costs vary dynamically to reflect the current level of congestion in the underlying link
- Load-insensitive
	- Link's cost does not explicitly reflect its current level of congestion
	- Used in todays internet


### The Link-State (LS) Routing Algorithm

- Link-state broadcast algorithm
- Each node can run the LS algorithm and compute the same set of least-cost paths as every other node
- Dijkstra's algorithm
	- Related to Prim's algorithm
	- Computes the least-cost path from one node to all other nodes
	- Iterative and has the property that after the kth iteration, the least-cost paths are known

$D(v)$ - cost of the least-cost path from the source node to destination $v$ as of this iteration of the algorithm

$p(v)$ - previous node along the current least-cost path from the source to $v$

$N'$ - subnet of nodes


**Link-State (LS) Algorithm for Source node u**

```c
// Initialization
N' = {u}
	for all nodes v
		if v is a neightbour of u
			then D(v) = c(u, v)
				else D(v) = âˆž

// Loop
	Find w not in N' such that D(w) is a minimum
	add w to N'
	update D(v) for each neighbour v of w and not in N':
		D(v) min(D(v), D(w) + c(w, v))
until N' = N
```

<img src="/images/Pasted image 20251226141554.png" alt="image" width="500">


<img src="/images/Pasted image 20251226141636.png" alt="image" width="500">

- $n$ nodes not counting the source
- In the first iteration, search though all $n$ nodes
- In the second iteration, $n-1$
- Total number of nodes to search is $n(n+1)/2$
- Preceding implementation of the LS algorithm has worst-case complexity of order $n$ squared or $O(n^2)$

<img src="/images/Pasted image 20251226142020.png" alt="image" width="500"><img src="/images/Pasted image 20251226142058.png" alt="image" width="500">

**Prevent Oscillations**
- Mandate that link costs not depend on the amount of traffic
- Ensure not all routers run the LS algorithm at the same time
	- Internet can self-synchronize among themselves (Floyd Synchronization)

### The Distance-Vector (DV) Routing Algorithm

- LS algorithm is uses global information
- Distance-vector (DV) algorithm is iterative, asynchronous, and distributed
- It is distributed in that each node receives some information from one or more of its directly attached neighbours, performs a calculation, and then distributes the results of its calculation back to its neighbours
- Iterative until no more information is exchanged between neighbours
- Asynchronous, does not require all of the nodes to operated in lockstep with each other
- $d_x(y)$ is the cost of the least-cost path from node x to node y
- Bellman-Ford equation

$d_x(y)=min_v{c(x, y)+d_v(y)}$

- $min_v$ is the taken over all of x's neighbours

<img src="/images/Pasted image 20251220161341.png" alt="image" width="500">
$d_{source}(dest)$
$d_v(z)$ = 5
$d_x(z)$ = 3
$d_w(z)$ = 3

$c(u, v) = 2$
$c(u, x) = 1$
$c(u, w) = 5$

$d_u(z)=min(2+5, 5+3, 1+3)=4$

- The result is the same as the Dijkstra algorithm
- Each node x begins with $D_x(y)$, an estimate of the cost of the least-cost path from itself to node y, for all nodes in N
- $D_x=[D_x(y): y in N]$ is the node x's distance vector
- For each neighbour v, the cost $c(x, v)$ from x to directly attached neighbour v
- Node x's distance vector $D_x$, containing x's estimate of its cost to all destinations, y in N
- The distance vector of each of its neighbours, that $D_v$ for each neighbour v of x

- From time to time, each nodes sends a copy of its distance vector to each of its neighbours
- When a node x receives a new distance, it saves it, then uses the Bellman-Ford equation to update its own distance vector

$D_x(y)=min(c(y, v) + D_v(y)$

- If the node distance has changed, node x will send its updated distance vector to each of its neighbours

**Distance-Vector (DV) Algorithm**

```c
// Init
for all destinations y in N:

```

- A node x updates its distance vector estimate when it either sees a cost change in one of its directly attached links or receives a distance vector update from some neighbour
- LS algorithm is a centralized algorithm, that requires each node to first obtain a complete map of the network before running the Dijkstra algorithm
- DV is decentralized and does not use global information
- DV-like algorithms are used in Internet's RIP and BGP, ISP IDRP, Novell IPX, and original ARPAnet

<img src="/images/Pasted image 20251226144429.png" alt="image" width="500">

- Leftmost column of the figure displays 3 initial routing tables for each of the three nodes

$Dx=[Dx(x),Dx(y),Dx(z)]=[0,2,7]$

- After initialization, each node sends its distance vector to each of its two neighbours
- Node x sends its distance vector $D_x=[0, 2, 7]$ to both nodes y and z
- Each node recomputes its own distance vector

$Dx(x)=0$
$Dx(y)=min{c(x,y)+Dy(y),c(x,z)+Dz(y)}=min{2+0, 7+1}=2$
$Dx(z)=min{c(x,y)+Dy(z),c(x,z)+Dz(z)}=min{2+1,7+0}=3$

- The second, column displays for each node, the new distance vector along with vectors just received from its neighbours
- The process of receiving updated distance vector from neighbours, recomputing routing tables entries, and informing neighbours of changed costs of the least-cost path to a destination continues until no update messages are send

**Distance-Vector Algorithm: Link-Cost Changes and Link Failure**

- Only two iterations are required for the DV algorithm to reach quiescent state


<img src="/images/Pasted image 20251226145319.png" alt="image" width="500">

A
- Link cost from y to x changes from 4 to 1
B
- Link cost increases
	- Before link cost change, y detects the link cost change and computes its new min-cost path to x
	- A routing loop is like a black hole
		- A packet destined for x arriving at y or z as of $t_1$ will bounce back and forth between two nodes forever
	- Referred to as the count-to-infinity problem

**Distance-Vector Algorithm: Adding Poisoned Reverse**
- Looping can be avoided using a technique known as poisoned reverse
- If z routes through y to get to destination x, then z will advertise to y that is distance to x is infinity
- Loops involving three of more nodes will not be detected by the poisoned reverse technique

**A Comparison of LS and DV Routing Algorithms**
- DV and LS algorithms take complementary approaches toward computing routing
- DV
	- Each nodes only take to its neighbour
- LS
	- Requires global information

1) Message complexity
2) Speed of convergence
3) Robustness

- Neither algorithm is an obvious choice, both are used in the internet

## Intra-AS Routing in the Internet: OSPF

Simplistic View of Routing
- Scale
	- Overhead involved in communicating, computing, and storing routing information becomes prohibitive
	- A DV algorithm that iterated among large number of routers would never converge
- Administrative autonomy
	- Internet is a network of ISPs
	- ISP desires to operates its network as it pleases or to hide internal organization

- These problems are solved by organizing routers into autonomous systems (ASs), with each AS consisting of a group of routers that are under the same admin control
- Some tier-1 ISPs use one AS for their entire network, others break ISP into tens of interconnected AS
- AS numbers are assigned by ICANN regional registries
- Routers within the same AS all run the same routing algorithm and have information about each other
- Routing algorithms within AS are called an intra-autonomous system routing protocol

**Open Shortest Path First (OSPF)**
- IS-IS are widely used for intra-AS routing
- Open in OSPF indicates that the routing protocol specification is publicly available
	- Cisco's EIGRP
- OSPF is a link-state protocol that uses flooding of link-state information and a Dijkstra's least-cost path algorithm
- Each router constructs a complete topological map (graph) of the entire AS
- Each router locally runs Dijkstra's to determine tree to all subnets
- Individual link costs are configured by the network admin

**Setting OSPF Link Weights**
- In order to achieve the goal of minimizing the max link utilization, the operator must find the set of link weights that achieves this goal

- A router broadcasts routing information to all other routers in the autonomous system, not just to its neighbours

Advances of OSPF
1. Security
2. Multiple same-cost paths
3. Integrated support for unicast and multicast routing
4. Support for hierarchy within a single As

## Routing Among the ISPs: BGP

- Routing a packet between a source and destination within the same AS is determined by the intra-AS routing protocol
- Across multiple AS uses inter-autonomous system routing protocol
	- Border Gateway Protocol (BGP)
- BGP is the most important of the all internet protocols
- Decentralized and asynchronous protocol

### The Role of BGP

- Every router has a forwarding table
- In BGP, packets are not routed to a specific destination, instead CIDRized prefixes, with each prefix representing a subnet or a collection of subnets

BGP
1. Obtain prefix reachability information from neighbouring ASs
2. Determine the best routes to the prefixes


### Advertising BGP Route Information

<img src="/images/Pasted image 20251227143258.png" alt="image" width="500">

- AS3 includes a subnet with prefix x
- Each router is either a gateway router or an internal router
- A gateway router is a router on the edge of an AS that directly connects to one or more routers
- An internal router connects only to hosts and routers within its own AS
- Pairs of routers exchange routing information over semi-permanent TCP connections using port 179
- Each TCP connection along with BGP message are called BGP connection
- BGP that spans two ASs is called an external BGP (eBGP)
- Session between routings in the same AS is canned an internal BGP (iBGP)

<img src="/images/Pasted image 20251227143608.png" alt="image" width="500">

<img src="/images/Pasted image 20251227143655.png" alt="image" width="500">

### Determining the Best Routes

- Routers often receive reachability information about dozens of different possible paths
- When router advertises a prefix across BGP connection, its includes BGP attributes
- A prefix along with its attributes is called a route
	- AS-PATH
	- NEXT-HOP

**Hot Potato Routing**
- The route chosen is the route with the least cost to the NEXT-HOP router beginning that route
- Initial router get is packet out as quickly as possible without worrying about the cost of the remaining portions of the path
- Selfish algorithm

**Route-Selection Algorithm**
1. A route is assigned a local preference value as one of its attributes
2. From the remaining routes, the route with the shortest AS-PATH is selected
3. From the remaining routes, hot potato routing is used
4. If more than one route still remains, the router uses BGP identifiers to select the route

### IP-Anycast

- BGP is often used to implement the IP-anycast service, which is commonly used in DNS
- CDN may replicate videos and other objects on servers in different countries
- DNS system can replicate DNS records on DNS servers throughout the world

<img src="/images/Pasted image 20251227144748.png" alt="image" width="500">

- CDN company assigned the same IP address to each of its servers and uses standard BGP to advertise this IP address from each of the servers
- Each router will locally use the BGP route-selection
- In practice, CDNs generally choose not to use IP-anycast because BGP routing changes can result in different packets of the same TCP connection arriving at different instances
- Used in DNS systems to direct DNS queries to the closest root DNS server

### Routing Policy

- AS routing policy can trump all other considerations, such as shortest AS path or hot potato routing

<img src="/images/Pasted image 20251227145228.png" alt="image" width="500">

- W and Y are ISPs
- X is a multi-homed access ISP
- Any traffic flowing across an ISPs backbone network must have either a source or a destination in a network that is a customer of that ISP

#### Why Are There Different Inter-AS and Intra-AS Routing Protocols

- Policy
	- Within as AS, everything is nominally under the same admin control
- Scale
	- If a single ISP becomes too large, it is possible to divide it into two ASs and perform inter-AS routing
- Performance


### Putting the Pieces Together: Obtaining Internet Presence

- Company will have a gateway router, which will be connected to a router in local ISP
	- DSL connection
	- Or other access solution
- Assign IP addresses
	- Web server
	- Mail server
	- DNS server
	- Gateway router
	- IP addresses
- Each router needs to known about the existence of company /24 prefix
- All internet routers will know about your prefix and forward datagrams


## The SDN Control Plane

- Network wide logic that controls packet forwarding among a network SDN enabled devices

4 Key Characteristics of an SDN Architecture
1. Flow-based forwarding
	1. Based on any number of header field values in the transport-layer, network layer, or link layer header
2. Separation of data plane and control plane
	1. Data plane consists of network switches
	2. Control plane consists of servers and software that determine and manage the switch flow tables
3. Network control functions: External to data-plane switches
	1. Software executes on servers that are both distinct and remote from the network switches
	2. Control plane
		1. SDN controller
			1. OS
			2. Set of network control applications
4. A programmable network
	1. Routing network control application might determine the end-end paths between sources and destinations

- Unbundling of network functionality in SDN has been likened to the earlier evolution from mainframe computers to personal computers

<img src="/images/Pasted image 20251227162435.png" alt="image" width="500">



### The SDN Control Plane: SDN Controller and SDN Control Applications

- SDN Controllers
	1) A communication layer: communicating between the SDN controller and controlled network devices
	2) A network-wide state management layer
	3) The interface to the network control application layer

<img src="/images/Pasted image 20251227162701.png" alt="image" width="500">

- Different types of APIs may be provided
	- REST request response interface

- Modern controllers such as OpenDaylight and ONOS have placed considerable emphasis on architecting a logically centralized but physically distributed controller platform that provides scalable services and high availability to controlled devices and network control applications

### OpenFlow Protocol

- Operates between an SDN controller and an SDN controlled switch or other devices implementing the OpenFlow AIP

Messages From Controller to Controlled Switch
- Configuration
- Modify state
- Read state
- Send packet

Messages From Controlled Switch to Controller
- Flow-removed
- Port-status
- Packet in

#### Google's Software Defined Global Network
- Google deploys a WAN that interconnects its data centres and server clusters (IXPs and ISPs)
- B4, has Google-designed SDN control plane built on OpenFlow
- Google controls all devices from the edge servers to routers in their network core
- Most bandwidth intensive applications are large scale data copies
- Local Open Flow Agent (OFA) connects to an Open Flow Controller (OFC) in the network control server (NCS)
- OFC also performs state management, keeping node and link status in a Network Information Base (NIB)

### Data and Control Plane Interaction: An Example

- Dijkstra's algorithm is executed as a separate application, outside packet switches
- Packet switches send link updates to the SDN controller and not to each other

<img src="/images/Pasted image 20251227163430.png" alt="image" width="500">

- Switch s1, experiencing a link failure between itself and s2, notifies the SDN controller of the link state change using OpenFlow port-status
- SDN controller receives message and notifies the link state manager, which updates database
- Network control application that implements Dijkstra's is updated
- Link state routing application interacts with the link-state manager to get updated link state
- Link state routing application interacts with flow table manager, which determines the flow tables to be updated
- Flow table manager uses OpenFlow to update flow table entries


### SDN: Past and Future

- SDN revolution is leading to the disruptive replacement of dedicated monolithic switches and routers
- A generalization of SDN known as network function virtualization (NFV) aims at disruptive replacement of sophisticated middleboxes

#### SND Controller Case Studies: The OpenDaylight and ONOS Controllers
- Proprietary SDN controllers
	- ONIX
	- Juniper Networks Control
	- Google's controller
- Open source
	- OpenDaylight controller
	- ONOS

**OpenDaylight Controller**

<img src="/images/Pasted image 20251227164017.png" alt="image" width="500">

- ODL's main set of controller components correspond to Fig. 5.15
- Network-service applications are the applications that determine how data-plane forwarding and other services, such as fire walling and load balancing, are accomplished in the controlled switches
- 2 interfaces
	- External applications with controller modules using a REST API over HTTP
	- Internal application via the Service Abstraction Layer (SAL)
- SAL is the controller's nerve centre, allowing controller components and applications to invoke each other's services and subscribe to events they generates
	- OpenFlow
	- SNMP (Simple Network Management Protocol)
- OVSBD is a protocol used to manage data centre switching

**ONOS Controller**

<img src="/images/Pasted image 20251227164346.png" alt="image" width="500">

- Northbound abstractions and protocols
	- Request high-level service
- Distributed core
	- Deployed as a service on a set of interconnected services with identical copies of ONOS software
- Southbound abstractions and protocols
	- Logically higher than canonical controller or the ODL controller
	- Masks the heterogeneity of underlying hosts, links, switches, and protocols

## ICMP: The Internet Control Message Protocol

- Used by hosts and routers to communicate network layer information to each other
	- Error reporting
- Considered part of IP, but lies above IP, as ICMP messages are carried inside IP datagrams
	- Messages are carried as IP payload, like TCP or UDP segments
- When a host receives an IP datagram with ICMP it demultiplexes the datagram's content to ICMP
	- Type
	- Code field
- Well known ping program sends an ICMP type 8 code 0 message to host, and receives a type 0 code 0 ICMP echo replay
- Source quench message is used for congestion control to allow a congested router to send an ICMP source quench message to a host to reduce transmission rate

<img src="/images/Pasted image 20251227164911.png" alt="image" width="500">

- Source host learns the number and the identities of routers that lie between it and the destination host and the round-trip time between two hosts
- New version of ICMP has been defined for IPv6 in RFC 4443

## Networking Management and SNMP

- Network management includes the deployment, integration, and coordination of the hardware, software, and human elements to monitor, test, poll, configure, analyze, evaluate, and control the network and element resources to meet the real-time, operational performance, and Quality of Service requirements at a reasonable cost

### The Network Management Framework

<img src="/images/Pasted image 20251227165224.png" alt="image" width="500">


Key Components of Network Management
1. Managing server
	1. Application with human intervention
	2. Running in a centralized network management station in network operation centre (NOC)
2. Manager device
	1. Piece of network equipment that resides on a managed network
	2. Several managed objects within a managed device
3. Each managed object is collected into a Management Information Base (MIB)
	1. Specified in a data description language known as SMI (Structure of Management Information)
4. Network management agent
	1. A process running in the managed device that communicates with the managing server
5. Network management protocol
	1. Runs between managing server and the managed devices
	2. Inform the server of exceptional events

### The Simple Network Management Protocol (SNMP)

- The Simple Network Management Protocol version 2 (SNMPv2)
- The most common use of SNMP is in a request response mode in which an SNMP managing server sends a request to an SNMP agent
- A second common usage of SNMP is for an agent to send an unsolicited message, known as a trap message
	- Used to notify a managing server of an exceptional situation that has resulted in changes to MIB object values

7 Types of SNMPv2
1) `GetRequest`
2) `GetNextRequest`
3) `GetNextRequest`
4) `InformRequest`
5) `SetRequest`
6) `Reponse`
7) `SNMPv2-Trap`


<img src="/images/Pasted image 20251227190106.png" alt="image" width="500">

- SNMP PDU is typically carried in the payload of a UDP datagram

## Summary

- 2 Approaches towards building a control plane
	- Per-router
	- Software defined networking (SDN)

- Routing algorithms for least cost paths in a graph
	- Lin state routing
	- Distance vector routing

- IP Network managing
	- ICMP
	- SNMP