- The network layer provides a communication service between any two network hosts
- Datagrams travel over communication links (wired and wireless) through packet switches (switches and routers)
- 2 different types of link-layer channels
	- Broadcast channels
		- Connect multiple hosts in wireless LANs, satellite networks, and hybrid fiber-coaxial cable (HFC) access networks
	- Point-to-point communication
		- Between two routers connected by a long distance link or Ethernet switch


## Introduction to the Link Layer

- A node is any device that runs a link layer protocol
	- Hosts, routers, switches, and WiFi access points
- Links are communication channels that connect adjacent nodes

Datagram Travel
1. WiFi link
2. Ethernet link
3. Link between link-layer switch and router
4. Link between the access point and link-layer switch
5. Link between router and link-layer switch
6. Ethernet link between switch and server

- A transmitting node encapsulates the datagram in a link-layer frame and transmits the frame into the link

<img src="/images/Pasted image 20251227191007.png" alt="image" width="500">


### The Services Provided by the Link Layer

Services of a Link Layer Protocol
- Framing
	- A data field, in which the network layer datagram is inserted
	- A number of header fields
- Link access
	- Medium access control (MAC) protocol specifies in the rules by which a frame is transmitted onto the link
- Reliable delivery
- Error detection and correction

### Where Is the Link Layer Implemented?

- The link layer is implemented in the router's line card
- The link layer is implemented in a network adapter, also known as a network interface card (NIC)
	- Single purpose chip that implements link-layer services
	- Hardware
		- Intel's 710 adapter
		- Atheros AR5006
- Most NIC were separate cards the plug into the PCI slot
- Network adapters are now integrated onto the host's motherboard

<img src="/images/Pasted image 20251227191532.png" alt="image" width="500">

- Controller takes a datagram that has been created and stored in hot memory by the higher layers of the protocol stack, encapsulates the datagram in a link-layer frame, then transmits the frame into the communication link
- Most of the link layer is implemented in hardware using host's CPI


## Error-Detection and Correction Techniques

- Bit-level error detection and correction
	- Detecting and correcting the corruption of bits in a link-layer frame send from one node to another physically connected neighbouring node
	- Often offered at the transport layer


<img src="/images/Pasted image 20251227191808.png" alt="image" width="500">

- Node D is augmented with error-detection and correction bits (EDC)
- D and EDC are send to receiving node in link-level frame
- D' and EDC' is received
- 3 techniques for detecting erroes
	- Parity check
	- Checksumming
	- Cyclic redundancy checks

### Parity Check

<img src="/images/Pasted image 20251227192021.png" alt="image" width="500">

- Even parity scheme
	- Include an additional bit for $d + 1$ bits
	- If an odd number is found for even, or vice versa, a bit error has occurred
	- Errors are often clustered together in "bursts"


<img src="/images/Pasted image 20251227192230.png" alt="image" width="500">

- 2-dimensional generalization of the single-bit parity scheme
- Parity value is computer for each row and for each column
- The parity of both column and row containing the flipped bit will be in error
- The ability of the receiver to both detect and correct errors is known as forward error correction (FEC)
	- Audio storage
	- Playback devices such as audio CDs
- FEC decreased the number of sender retransmissions

### Checksumming Methods

- $d$ bits of data are treated as a sequence of $k$-bits integers
- Sum integers and use the resulting sum as the error detection bits
- Internet checksum
	- Bytes of data are treated as 16-bit integers and summer
	- 1s complement of sum forms the checksum in the segment header
- Transport layer is implemented in software and needs fast error-detection
- Link layer is implemented in dedicated hardware in adapters, which can rapidly perform more complex CRC operations

### Cyclic Redundancy Check (CRC)

- Today's computer networks is based on cyclic redundancy check (CRC) code
- CRC codes are also known as polynomial code
	- View bit string to be send as a polynomial whose coefficients are the 0 and 1 values
- The sender and receiver must first agree on an $r + 1$ bit pattern, known as a generator
- For a given piece of data, D, the sender will choose r additional bits, R, and append them to D such that the resulting $d + r$ bit pattern is exactly divisible by G using modulo-2 arithmetic
- If the remainder is non-zero, the receiver knowns that an error has occurred
- Addition and subtraction are identical
	- Bitwise XOR operand

```c
1011 XOR 0101 = 1110
1001 XOR 1101 = 0100

1011 - 0101 = 1110
1001 - 1101 = 0100
```

- Multiplication and division are the same as in base-2 arithmetic, except that any required addition or subtraction is done without carries or borrows

<img src="/images/Pasted image 20251227234753.png" alt="image" width="500">

<img src="/images/Pasted image 20251227234826.png" alt="image" width="500">

- Each of the CRC standards can detect burst errors of fewer than $r+1$ bits

## Multiple Access Links and Protocols

- 2 types of network links
	- Point to point links
		- Single sender at one end of the link and a single receiver at the other end of the link
		- Point-to-point protocol (PPP)
		- High-level data link control (HDLC)
	- Broadcast links
		- Multiple sending and receiving nodes all connected to the same, single, shared broadcast channel
		- Ethernet
		- Wireless LANs
- Multiple access protocols

<img src="/images/Pasted image 20251227235214.png" alt="image" width="500">

- More than two nodes can transmit frames at the same time
- All of the nodes receive multiple frames at the same time
	- Transmitted frames collide at all of the receivers
	- None of the nodes can receive the frames and are lost
- 3 categories of multiple access protocol
	- Channel partitioning protocols
	- Random access protocols
	- Taking turns protocol

Characteristics of Broadcast channel
1. When only one node has data to send, that node has a throughput of R bps
2. When M nodes have data to send, each node has a throughput of R/M bps
3. Protocol is decentralized
4. Protocol is simple

### Channel Partitioning Protocols

- Time-division multiplexing (TDM) and frequency-division multiplexing (FDM) are two techniques that can be used to partition a broadcast channel's bandwidth among all nodes sharing that channel
- TDM divides time into time frames and further divides each time frame into N time slots

<img src="/images/Pasted image 20251227235700.png" alt="image" width="500">

- TDM eliminates collisions and is fair
	- Nodes is limited to an average rate of R/N bps even if its the only packet
	- Node must always wait for its turn in the transmission sequence
- FDM divides the R bps channel into different frequencies
	- Avoids collisions and divides the bandwidth fairly among the N nodes
	- A node is limited to a bandwidth of R/N

- Third channel partitioning protocol is code division multiple access (CDMA)
	- Assigns a different code to each node

### Random Access Protocols

- A transmitting node always transmits at the full rate of the channel, R bps
- When there is a collision, each node involved in the collision repeatedly retransmits its frame until its frame get through without a collision
- ALOHA protocols

**Slotted ALOHA**
- When there is a collision, node effectively tosses a biased coin to retransmit
- Allows a node to transmit continuously at the full rate, R
- Highly decentralized

<img src="/images/Pasted image 20251228000316.png" alt="image" width="500">

- A slot in which exactly one node transmits is said to be a successful slot
- The efficiently of a slotted multiple access protocol is defined to be the long-run fraction of successful slots in the case when there are a large number of active nodes

**ALOHA**

<img src="/images/Pasted image 20251231125946.png" alt="image" width="500">

**Carrier Sense Multiple Access (CSMA)**
- Carrier sensing
	- Node listens to the channel before transmitting
- Collision detection
	- A transmitting node listens to the channel while it is transmitting

#### Norm Abramson and Alohanet

<img src="/images/Pasted image 20251231130314.png" alt="image" width="500">


**Carrier Sense Multiple Access with Collision Detection (CSMA/CD)**

<img src="/images/Pasted image 20251231130356.png" alt="image" width="500">

- The binary exponential backoff algorithm, used in Ethernet as well as DOCSIS cable network multiple access protocols

**CSMA/CD Efficiency**
- Efficiency of CSMA/CD tot the long-run fraction of time during which frames are being transmitted on the channel without collisions when there is a large number of active nodes

### Taking-Turns Protocols

 - Polling protocol
	 - Requires one of the nodes to be designated as a master node
	 - The master node polls each of the nodes in a round-robin fashion
	 - Eliminates the collisions and empty slots that plague random access protocols
	 - Polling delay
	 - If one master nodes fails, the entire channel becomes inoperative
- Token-passing protocol
	- No master node
	- Special purpose frame known as a token is exchanged among the nodes in sone fixed order


### DOCSIS: The Link-Layer Protocol for Cable Internet Access

- Multiple access protocols
	- Channel partitioning
	- Random access
	- Taking turns

- A cable access network connects several thousand residential cable modems to a cable modem termination system (CMTS)
- Data-Over-Cable Service Interface Specifications (DOCSIS) specifies the cable data network architecture and its protocols
- DOCSIS uses FDM to divide the downstream (CMTS to modem) and upstream (modem to CMTS)

<img src="/images/Pasted image 20251231131017.png" alt="image" width="500">


## Switched Local Area Networks

<img src="/images/Pasted image 20251231131053.png" alt="image" width="500">

- 2 servers and a router with 4 switches
- Instead of using IP addresses, link-layer addresses forward link-layer frames through the network of switches

### Link-Layer Addressing and ARP

- Hosts and routers have link-layer and network addresses
- Address Resolution Protocol (ARP) provides a mechanisms to translate IP addresses to link-layer addresses

**MAC Addresses**
- Hosts and router adapters have link-layer addresses
- A host or router with multiple network interfaces will have multiple link-layer addresses associated with it
- A link-layer address is variously called a LAN address, a physical address, or a MAC address
- For most LANs, the MAC address is 6 bytes long, expressed in hexadecimal
- No two adapters have the same address

<img src="/images/Pasted image 20251231131621.png" alt="image" width="500">

- IEEE manages the MAC address space
- An adapter's MAC address has a flat structure and does not change where the adapter goes
- IP addresses have a hierarchical structure, and a host's IP addresses needs to be changed when the host moves
- The sender adapter inserts the destination adapter's MAC address into the frame and then sends the frame into the LAN
- 802.11 also broadcasts frames
- An adapter may receive a frame that isn't addressed to it
- When an adapter receives a frame, it will check to see whether the destination MAC address in the frame matches its own
- If matched, the adapter extracts the enclosed datagram and passes the datagram up the protocol stack
- Sometimes a sending adapter does want all the other adapters on the LAN to receive and process the frame
	- Uses special MAX broadcast address into the destination address
	- FF-FF-FF-FF-FFFF

**Address Resolution Protocol (ARP)**
- Network layer (IP)
- Link layer (MAC)
- Address Resolution Protocol (ARP) translates between the two

#### Keeping the Layers Independent

- LANs are designed for arbitrary network layer protocols, not just IP and the internet

<img src="/images/Pasted image 20251231132835.png" alt="image" width="500">


- An ARP module in the sending host takes any IP address on the same LAN as input, and returns the corresponding MAC address
- ARP resolves an IP address to a MAC address
	- Only for hosts and router interfaces on the same subnet

<img src="/images/Pasted image 20251231133034.png" alt="image" width="500">

- Each host and router has an ARP table in its memory, which contains mappings of IP addresses to MAC addresses
- Sender constructs an ARP packet
	- Sending and receives IP and MAC addresses
- Query ARP message is sent within a broadcast frame, whereas the response ARP message is send within a standard frame
- ARP is plug-and-play
	- ARP table gets built automatically
- ARP packet is encapsulated within a link-layer frame and thus lies architecturally above the link layer
- ARP packets has fields containing link-layer addresses and thus is arguably a link-layer protocol, but also contains network-layer addresses

**Sending a Datagram off the Subnet**
- Each host has exactly one IP address and one adapter
- A router has an UP address for each of its interface
- For each interface there is also an ARP module and an adapter

<img src="/images/Pasted image 20251231133447.png" alt="image" width="500">


### Ethernet

- Alternative technologies
	- Token ring
	- FDDI
	- ATM
- Ethernet is the most prevalent wired LAN technology
- First widely deployed high-speed LAN
- Higher data rate
- Cost effective
- Invented in the mid 1970s by Bob Metcalfe and David Boggs
- Used coaxial bus to interconnect the nodes
	- Bus topology
- Most universities had replaced their LANs with Ethernet using a hub-based star topology
- A hub is a physical layer device that acts on individual bits rather than frames
- Hub recreates the bit, boosts its energy strength, and transmits the bit onto all the other interfaces
- 2000s, Ethernet continued to use a star topology, but the hub at the centre was replaced with a switch

**Ethernet Frame Structure**

![[Pasted image 20260104120350.png]]

- The sending adapter encapsulates the IP datagram within an Ethernet frame and passes the frame to the physical layer

6 Fields of the Ethernet Frame

1. Data field (46 to 1500 bytes)
	1. IP datagram
2. Destination address (6 bytes)
	1. MAC address of the destination adapter
3. Source address (6 bytes)
	1. MAC address of the adapter that transmits the frame onto the LAN
4. Type field (2 bytes)
5. Cyclic redundancy check (CRC) (4 bytes)
	1. Detect bit errors in the frame
6. Preamble (8 bytes)


- Ethernet technologies provide an unreliable service to the network layer


#### Bob Metcalfe and Ethernet

- 1979, Metcalfe formed 3Com, which developed and commercialized networking technology

- If application is using UDP, then the application in Host B will see gaps in the data
- If using TCP, Host B will now acknowledge the data container in discarded frames, causing Host A to retransmit

**Ethernet Technologies**
- Ethernet comes in many different flavours
	- 10BASE-T
	- 100BASE-T
	- 1000BASE-LX
	- 10GBASE-T
	- 40GBASE-T

- First part, refers to the speed of the standard
- Final part is the physical media itself
	- T = twisted pair copper wires
- Historically, an Ethernet was initially made from segments of coaxial cables
- Longer runs could be obtained by using a repeater
	- A physical layer device the receives a signal on the input side, and regenerates the signal on the output side
	- Hubs are called buffered distributors
- Originally Ethernet was a broadcast link in which frame collisions occurred when nodes transmitted at the same time
- Ethernet included the CSMA/CD protocol
- A switch coordinates its transmissions and never forwards more than one frame onto the same interface at any time
- Modern switches are full-duplex, so that a switch and a node can each send frames to each other at the same time without interference
- In a switch-based Ethernet LAN there are no collisions and there is not need for a MAC protocol
- Today, Ethernet frames are carried over a variety of media

### Link-Layer Switches

- The role of the switch is to receive incoming link-layer frames and forward them onto outgoing links
- Switch is transparent to the hosts and routers in the subnet
- A host/router addresses a frame to another host.router and sends the frame into the LAN
- Switch output interface have buffers

**Forwarding and Filtering**
- Filtering is the switch function that determines whether a frame should be forwarded to some interface or should just be dropped
- Forwarding is the switch function that determined the interface to which a frame should be directed
- Switch filtering and forwarding are done with a switch table
- Many modern packet switches can be configured to forward on the basis of layer-2 destination MAC addresses or layer-3 IP destination addresses
- Switches forward packers based on MAC addresses rather than on IP addresses
- Traditional switch table is constructed in a different manner from a router's forwarding table

![[Pasted image 20260104122351.png]]

- As long as the switch table is complete and accurate, the switch forwards frames toward destinations without any broadcasting

**Self-Learning**
- The switch table is initially empty
- For each incoming frame received on an interface, the switch stores in its table
	- MAC address
	- Interface from which the frame arrived
	- Current time
- Switch deletes an address in the table if no frames are received with that address as the source address after some period of time (aging time)
- Switches are plug-and-play devices because they require no intervention from a network administrator or user
- Switches are full-duplex, meaning any switch interface can send and receive at the same time

**Properties of Link-Layer Switching**
- Elimination of collisions
	- No wasted bandwidth due to collisions
- Heterogeneous Links
	- Different links in the LAN can operate at different speeds and can run over different media
- Management
	- Eases network management
		- Malfunctions and continually sends Ethernet frames (jabbering adapter)

#### Sniffing a Switches LAN: Switch Poisoning

- A sniffer will be able to sniff all Ethernet broadcast frame with broadcast destination address
- Switch poisoning
	- Send tons of packets to the switch with many different bogus source MAC addresses

**Switches vs. Routers**
- 

### Virtual Local Area Networks (VLANs)

## Link Virtualization: A Network as a Link Layer

### Multi-protocol Label Switching (MPLS)

## Data Centre Networking

### Retrospective: A Day in the Life of a Web Page Request

### Getting Started: DHCP, UDP, IP, and Ethernet

### Still Getting Started: Intra-Domain Routing to the DNS Server
### Still Getting Started: TCP and HTTP


## Summary